# default:
#   variables:
#     MESSAGE: $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG

include:
  # - local: /step_helpers/openshift/hacks.yml
  - local: /step_helpers/helpers/merge.yml
  # - local: /step_helpers/ansible/install.yml

.send_slack_notification: &send_slack_notification
  image:
    name: quay.io/hyperkineticnerd/ansible
  inherit:
    variables: true
  variables:
    DEFAULT_ANSIBLE_INVENTORY: inventories/hosts.ini
    DEFAULT_ANSIBLE_PLAYBOOK: playbooks/slack.yml
    ANSIBLE_INVENTORY: ${DEFAULT_ANSIBLE_INVENTORY}
    PLAYBOOK: ${DEFAULT_ANSIBLE_PLAYBOOK}
    SERVER_URI: 'gitlab.developer.hkn.lab'
    REPO_PATH: '/gitlab-pipelines/helpers'
    HELPER_REPO_URL: 'https://gitlab-ci-token:${CI_JOB_TOKEN}@${SERVER_URI}${REPO_PATH}'
  before_script:
    # - echo $HELPER_REPO_URL
    # - echo ${CI_JOB_TOKEN}
    # - echo ${SERVER_URI}
    # - echo ${REPO_PATH}
    # - echo $HOME
    # - echo $XDG_RUNTIME_DIR
    # - !reference [.openshift_debug, before_script]
    # - !reference [.openshift_hacks, before_script]
    # - !reference [.ansible_depends, before_script]
    - !reference [.git_merge_helpers, before_script]
    # - !reference [.ansible_install, before_script]
    - /usr/local/bin/ansible --version
  script:
    # - ansible-galaxy install -r roles/requirements.yml
    - /usr/local/bin/ansible-playbook -i $ANSIBLE_INVENTORY $PLAYBOOK
